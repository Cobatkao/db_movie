{"version":3,"sources":["script.js"],"names":["paging","init","$tab","$","$panel","bind","_this","on","index","addClass","siblings","removeClass","eq","tpl","isToBottom","$Viewport","$Content","height","scrollTop","insertTpl","ele","$node","find","attr","images","small","text","title","rating","average","collect_count","year","genres","join","directors","map","i","name","casts","m","top250Page","$element","$content","isLoading","isFinishe","page","count","getData","data","render","console","log","total","callback","ajax","url","type","dataType","start","done","ret","fail","err","subjects","forEach","item","append","usBoxPage","searchPage","app"],"mappings":"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","file":"script.75da7f30.map","sourceRoot":"..","sourcesContent":["var paging = {\n  init: function () {\n    this.$tab = $('footer > .bt-tab')\n    this.$panel = $('main > section')\n    this.bind()\n  },\n\n  bind: function () {\n    var _this = this //or arrow function\n    this.$tab.on('click', function () {\n      var index = $(this).index()\n      $(this).addClass('fired').siblings().removeClass('fired')\n      _this.$panel.eq(index).addClass('fired').siblings().removeClass('fired')\n    })\n  }\n}\n\n//模板部分\nvar tpl = {\n  isToBottom: function($Viewport, $Content) {\n    return $Viewport.height() + $Viewport.scrollTop() + 30 > $Content.height()\n  },\n\n  insertTpl: function (ele) {\n    var $node = $(`\n      <div class=\"item\">\n        <a href=\"#\">\n          <div class=\"cover\">\n            <img src=\"\" alt=\"\">\n          </div>\n          <div class=\"detail\">\n            <h2></h2>\n            <div class=\"extra\">\n              <span class=\"score\"></span>  / <span class=\"collect\"></span>收藏\n            </div>\n            <div class=\"extra\">\n              <span class=\"year\"> / <span class=\"genres\"></span> \n            </div>\n            <div class=\"extra\">\n              <span class=\"director\"></span>\n            </div>\n            <div class=\"extra\">\n              <span class=\"casting\"></span>\n            </div>\n          </div>\n        </a>\n      </div>\n    `)\n    $node.find('.cover img').attr(\"src\", ele.images.small)\n    $node.find('.detail h2').text(ele.title)\n    $node.find('.extra .score').text(ele.rating.average)\n    $node.find('.extra .collect').text(ele.collect_count)\n    $node.find('.extra .year').text(ele.year)\n    $node.find('.extra .genres').text(ele.genres.join(' / '))\n    $node.find('.extra .director').text(`导演：${ele.directors.map(i=>i.name).join('、')}`)\n    $node.find('.extra .casting').text(`演员：${ele.casts.map(m=>m.name).join('、')}`)\n\n    return $node\n  }\n}\n\n//top250页面\nvar top250Page = {\n  init: function () {\n    var _this = this\n    this.$element = $('main')\n    this.$content = this.$element.find('.container')\n    this.isLoading = false\n    this.isFinishe = false\n    this.page = 0\n    this.count = 20\n    this.bind()\n    //data参数即数据到达后的ret\n    this.getData(function (data) {\n      _this.render(data)\n      _this.page++\n    })\n  },\n\n  bind: function () {\n    var _this = this\n    this.$element.on('scroll', function () {\n      console.log(_this.isLoading)\n      if (tpl.isToBottom(_this.$element, _this.$content) && !_this.isLoading && !_this.isFinishe) {\n        console.log('reach bottom and ready to send data!')\n        _this.getData(function (data) {\n          _this.render(data)\n          _this.page++\n          if (_this.count * _this.page >= data.total) {\n            _this.isFinishe = true\n          }\n        })\n      }\n    })\n  },\n\n  getData: function (callback) {\n    var _this = this\n    console.log(_this.page)\n    console.log(_this.count)\n    if (_this.isLoading) return\n    //数据已发出，未到达\n    _this.isLoading = true\n    _this.$element.find('.loader').addClass('fired')\n    $.ajax({\n      url: 'https://douban.uieee.com/v2/movie/top250',\n      type: 'GET',\n      dataType: 'jsonp',\n      data: {\n        start: this.count * this.page,\n        count: this.count //20\n      }\n    }).done(function (ret) {\n      console.log(ret)\n      _this.isLoading = false\n      _this.$element.find('.loader').removeClass('fired')\n      //执行回调\n      callback(ret)\n    }).fail(function (err) {\n      console.log('数据异常:' + err)\n    })\n  },\n\n  render: function (data) {\n    var _this = this\n    data.subjects.forEach(function (item) {\n      var $node = tpl.insertTpl(item)\n      _this.$content.append($node)\n    })\n  }\n}\n\n\n\n\n\n\n\nvar usBoxPage = {\n  init: function () {\n    this.$element = $('#beimei')\n\n  },\n\n  start: function () {\n\n  }\n}\n\nvar searchPage = {\n  init: function () {\n\n  },\n  bind: function () {\n\n  },\n  start: function () {\n\n  }\n}\n\nvar app = {\n  init: function () {\n    //初始化页面\n    paging.init()\n    top250Page.init()\n    usBoxPage.init()\n    searchPage.init()\n  }\n}\n//初始化\napp.init()"]}
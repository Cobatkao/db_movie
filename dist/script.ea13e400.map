{"version":3,"sources":["script.js"],"names":["paging","init","$tab","$","$panel","bind","_this","on","index","addClass","siblings","removeClass","eq","tpl","isToBottom","$Viewport","$Content","height","scrollTop","insertTpl","ele","$node","find","attr","alt","images","small","text","title","rating","average","collect_count","year","genres","join","directors","map","i","name","casts","m","top250Page","$element","$content","isLoading","isFinished","page","count","getData","data","render","clock","clearTimeout","setTimeout","console","log","total","callback","ajax","url","type","dataType","start","done","ret","fail","err","subjects","forEach","item","append","usBoardPage","subject","search","$container","$Result","$input","e","keyCode","keyword","val","q","app"],"mappings":"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","file":"script.ea13e400.map","sourceRoot":"..","sourcesContent":["const paging = {\n  init: function () {\n    this.$tab = $('footer > .bt-tab')\n    this.$panel = $('main > section')\n    this.bind()\n  },\n\n  bind: function () {\n    var _this = this //or arrow function\n    this.$tab.on('click', function () {\n      var index = $(this).index()\n      $(this).addClass('fired').siblings().removeClass('fired')\n      _this.$panel.eq(index).addClass('fired').siblings().removeClass('fired')\n    })\n  }\n}\n\n//模板\n const tpl = {\n  isToBottom: function($Viewport, $Content) {\n    return $Viewport.height() + $Viewport.scrollTop() + 30 > $Content.height()\n  },\n\n  insertTpl: function (ele) {\n    var $node = $(`\n      <div class=\"item\">\n        <a href=\"#\">\n          <div class=\"cover\">\n            <img src=\"\" alt=\"\">\n          </div>\n          <div class=\"detail\">\n            <h2></h2>\n            <div class=\"extra\">\n              <span class=\"score\"></span>  / <span class=\"collect\"></span>收藏\n            </div>\n            <div class=\"extra\">\n              <span class=\"year\"> / <span class=\"genres\"></span> \n            </div>\n            <div class=\"extra\">\n              <span class=\"director\"></span>\n            </div>\n            <div class=\"extra\">\n              <span class=\"casting\"></span>\n            </div>\n          </div>\n        </a>\n      </div>\n    `)\n    $node.find('a').attr('href', ele.alt)\n    $node.find('.cover img').attr(\"src\", ele.images.small)\n    $node.find('.detail h2').text(ele.title)\n    $node.find('.extra .score').text(ele.rating.average)\n    $node.find('.extra .collect').text(ele.collect_count)\n    $node.find('.extra .year').text(ele.year)\n    $node.find('.extra .genres').text(ele.genres.join(' / '))\n    $node.find('.extra .director').text(`导演：${ele.directors.map(i=>i.name).join('、')}`)\n    $node.find('.extra .casting').text(`演员：${ele.casts.map(m=>m.name).join('、')}`)\n\n    return $node\n  }\n}\n\n//top250页面\nconst top250Page = {\n  init: function () {\n    var _this = this\n    this.$element = $('#top-250')\n    this.$content = this.$element.find('.container')\n    //是否数据正在加载\n    this.isLoading = false\n    //是否载入完所有数据\n    this.isFinished = false\n    this.page = 0\n    this.count = 20\n    this.bind()\n    //data参数即数据到达后的ret\n    this.getData(function (data) {\n      _this.render(data)\n      _this.page++\n    })\n  },\n\n  bind: function () {\n    var _this = this\n    if(_this.clock) {\n      clearTimeout(_this.clock)\n    }\n    _this.clock = setTimeout(function() {\n      _this.$element.on('scroll', function () {\n        console.log(_this.isLoading)\n        //每次滚动判断 0.是否滚动到最底部 1.数据没有加载完 2.数据是否正在加载\n        if (tpl.isToBottom(_this.$element, _this.$content) && !_this.isLoading && !_this.isFinished) {\n          console.log('reach bottom and ready to send data!')\n          _this.getData(function (data) {\n            _this.render(data)\n            _this.page++\n            if (_this.count * _this.page >= data.total) {\n              _this.isFinished = true\n            }\n          })\n        }\n      })\n    }, 300)\n  },\n\n  getData: function (callback) {\n    var _this = this\n    _this.isLoading = true\n\n    console.log(_this.page)\n    console.log(_this.count)\n\n    //数据已发出，未到达\n    _this.$element.find('.loader').addClass('fired')\n    $.ajax({\n      url: 'https://douban.uieee.com/v2/movie/top250',\n      type: 'GET',\n      dataType: 'jsonp',\n      data: {\n        start: this.count * this.page,\n        count: this.count //20\n      }\n    }).done(function (ret) {\n      console.log(ret)\n      //数据已到达\n      _this.isLoading = false\n      _this.$element.find('.loader').removeClass('fired')\n      //执行回调\n      callback(ret)\n    }).fail(function (err) {\n      console.log('数据异常:' + err)\n    })\n  },\n\n  render: function (data) {\n    var _this = this\n    data.subjects.forEach(function (item) {\n      var $node = tpl.insertTpl(item)\n      _this.$content.append($node)\n    })\n  }\n}\n\nconst usBoardPage = {\n  init: function() {\n    var _this = this\n    this.$element = $('#beimei')\n    this.$content = this.$element.find('.container')\n    this.getData(function(data){\n      _this.render(data)\n    })\n  },\n\n  getData: function(callback) {\n    $.ajax({\n      url : 'https://douban.uieee.com/v2/movie/us_box',\n      data : {\n          start : 0,\n          count : 10\n      },\n      dataType : 'jsonp'\n    }).done(function(ret){\n      console.log(ret)\n      callback(ret)\n    })\n  },\n\n  render: function(data) {\n    var _this = this\n    data.subjects.forEach(function(item){\n        var $node = tpl.insertTpl(item.subject)\n        _this.$content.append($node)\n    })\n  }\n}\n\nconst search = {\n  init: function() {\n    var _this = this\n    this.$container = $('#Search')\n    this.$content = this.$container.find('.search-result .container')\n    this.page = 0\n    this.count = 10\n    this.isLoading = false\n    this.isFinished = false\n    this.isToBottom = function($Viewport, $Result, $input) {\n      return $Viewport.height() + $Viewport.scrollTop() + 30 > $Result.height() + $input.height()\n    },\n    this.bind()\n    this.getData(function (data) {\n      _this.render(data)\n      _this.page++\n    })\n  },\n\n  bind: function() {\n    var _this = this\n    this.$container.find('.search-area .button').on('click', function() {\n      console.log('click!')\n      _this.getData(function(data) {\n        _this.render(data)\n      })\n    })\n    this.$container.find('.search-area input').on('keyup', function(e) {\n      if(e.keyCode === 13) {\n        _this.getData(function(data) {\n          _this.render(data)\n        })\n      }\n    })\n\n    if(_this.clock) {\n      clearTimeout(_this.clock)\n    }\n\n    _this.clock = setTimeout(function() {\n      _this.$container.on('scroll', function () {\n        console.log(_this.isLoading)\n        //每次滚动判断 0.是否滚动到最底部 1.数据没有加载完 2.数据是否正在加载\n        if (_this.isToBottom(_this.$container, _this.$container.find('.search-result'), _this.$container.find('.search-area')) && !_this.isLoading && !_this.isFinished) {\n          console.log('reach bottom and ready to send data!')\n          _this.getData(function (data) {\n            _this.render(data)\n            _this.page++\n            if (_this.count * _this.page >= data.total) {\n              _this.isFinished = true\n            }\n          })\n        }\n      })\n    }, 300)\n  },\n        \n  getData: function(callback) {\n    var _this = this\n    _this.$container.find('.loader').addClass('fired')\n    var keyword = this.$container.find('.search-area input').val()\n    this.isLoading = true\n    $.ajax({\n      url: 'https://douban.uieee.com/v2/movie/search',\n      data: {\n        q: keyword,\n        start: this.count * this.page,\n        count: this.count\n      },\n      dataType: 'jsonp'\n    }).done(function(ret) {\n      _this.isLoading = false\n      _this.$container.find('.loader').removeClass('fired')\n      callback(ret)\n    })\n  },\n\n  render: function(data) {\n    var _this = this\n    data.subjects.forEach(function (item) {\n      var $node = tpl.insertTpl(item)\n      _this.$content.append($node)\n    })\n  }\n}\n\nconst app = {\n  init: function () {\n    //初始化页面\n    paging.init()\n    top250Page.init()\n    usBoardPage.init()\n    search.init()\n  }\n}\n//初始化\napp.init()"]}